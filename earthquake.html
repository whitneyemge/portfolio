<!DOCTYPE html>
<html>
	<head>
		<title>Earthquakes and Buoy Live Feeds</title>
		<!-- page style -->
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" href="assets/css/main.css" />
		<!-- mapbox libraries -->
		<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.50.0/mapbox-gl.js'></script>
		<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.50.0/mapbox-gl.css' rel='stylesheet' />
		<!--google map library -->
		<script async defer src="https://maps.googleapis.com/maps/api/js?key=&callback=initMap"></script>
	</head>

	<body>
		<!-- Title and info -->
			<section class="wrapper style1 align-center">
				<div class="inner">
					<h2>Live Earthquake and Buoy Feeds</h2>
					<p>These maps show...</p>
				</div>
			</section>

		<!-- div for earthquake map -->
		<div id='equake' style='width: 90vw; height: 75vh;'></div>

		<script>

			mapboxgl.accessToken = 'pk.eyJ1IjoiZW1nZXciLCJhIjoiY2sybzlheDB4MDJrdDNwbXp1OXVmN3dseCJ9.ukmQwSpvGDqj0hChY4ZUyQ';

			var map = new mapboxgl.Map({
			    container: 'equake',
			    style: 'mapbox://styles/emgew/ck3dwngd90q0y1cmwwo8z7863',
			    zoom: 1
			});
//Thanks to Mapbox GL JS Create and style clusters: https://docs.mapbox.com/mapbox-gl-js/example/cluster/
			map.on('load', function(){
				map.addSource('earthquakes', {
							"type": "geojson",
							"data": "https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/2.5_week.geojson",
							cluster: true,
							clusterMaxZoom: 10,
							clusterRadius: 20
						});

				map.addLayer({
				id: "clusters",
				type: "circle",
				source: "earthquakes",
				filter: ["has", "point_count"],
				paint: {
				// Use step expressions (https://docs.mapbox.com/mapbox-gl-js/style-spec/#expressions-step)
				// with three steps to implement three types of circles:
				//   * Blue, 20px circles when point count is less than 100
				//   * Yellow, 30px circles when point count is between 100 and 750
				//   * Pink, 40px circles when point count is greater than or equal to 750
				"circle-color": [
				"step",
				["get", "point_count"],
				"#51bbd6",
				100,
				"#f1f075",
				750,
				"#f28cb1"
				],
				"circle-radius": [
				"step",
				["get", "point_count"],
				20,
				100,
				30,
				750,
				40
				]
				}
				});

					map.addLayer({
					id: "cluster-count",
					type: "symbol",
					source: "earthquakes",
					filter: ["has", "point_count"],
					layout: {
					"text-field": "{point_count_abbreviated}",
					"text-font": ["DIN Offc Pro Medium", "Arial Unicode MS Bold"],
					"text-size": 12
					}
					});

					map.addLayer({
					id: "unclustered-point",
					type: "circle",
					source: "earthquakes",
					filter: ["!", ["has", "point_count"]],
					paint: {
					"circle-color": "#11b4da",
					"circle-radius": 4,
					"circle-stroke-width": 1,
					"circle-stroke-color": "#fff"
					}
					});

			map.on('click', 'equakes', function (quake) {
						var coordinates = quake.features[0].geometry.coordinates;
						var description = "<h4>"+"Earthquake Details"+"</h4>"+"<p>Magnitude: " + quake.features[0].properties.mag + "<br>Location: " + quake.features[0].properties.place + "<br>" +
				 		"More Information: " + quake.features[0].properties.url + "</p>";
						new mapboxgl.Popup()
										.setLngLat(coordinates)
										.setHTML(description)
										.addTo(map);
			});
		});

		</script>

		<br>

		<!-- div for buoy map -->
		<div id='buoys' style='width: 90vw; height: 75vh;'></div>

		<script>

			function initMap() {
				var map = new google.maps.Map(
						document.getElementById('buoys'), {
							zoom: 1,
							mapTypeId: 'terrain'
			});

			//Live KML feed from National Oceanic and Atmospheric Administration's National Data Buoy Center: https://www.ndbc.noaa.gov/
				var buoylayer = new google.maps.KmlLayer({
					url: 'https://www.ndbc.noaa.gov/kml/buoycams.kml',
					map: map
					});
				}

		</script>

		<!-- Sources -->
		<section class="wrapper style1 align-center">
			<div class="inner">
				<h3>Data Sources</h3>
				<p><a href="" target="_blank">TEXT</a>
				<br><a href="" target="_blank">TEXT</a></p>
			</div>
		</section>

		<!-- Home Button -->
		<footer class="wrapper style1 align-center">
			<div class="inner">
				<ul class="actions stacked">
					<li><a href="https://whitneyemge.github.io/portfolio/" class="button">Back to Home</a></li>
				</ul>
			</div>
		</footer>

	</body>
</html>
