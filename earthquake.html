<!DOCTYPE html>
<html>
	<head>
		<!-- the mapbox libraries -->
		<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.50.0/mapbox-gl.js'></script>
		<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.50.0/mapbox-gl.css' rel='stylesheet' />
	</head>

	<body>
		<!-- the div for the map -->
		<div id='map' style='width: 90vw; height: 75vh;'></div>

		<script>

			mapboxgl.accessToken = 'pk.eyJ1IjoiZW1nZXciLCJhIjoiY2sybzlheDB4MDJrdDNwbXp1OXVmN3dseCJ9.ukmQwSpvGDqj0hChY4ZUyQ';

			//The map variable, set initial style, center/zoom
			var map = new mapboxgl.Map({
			    container: 'map',
			    style: 'mapbox://styles/mapbox/streets-v9',
			    center: [-122, 47],
			    zoom: 0
			});

			//on map load, run function to load the geojson
			map.on('load', function(){
				//add a source layer for earthquakes
				map.addSource('earthquakes', {
							"type": "geojson",
							"data": "https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/2.5_week.geojson"
					});
					//add the earthquakes to the map
					map.addLayer({
						"id":"equakes",
						"type":"circle",
						"source":"earthquakes"
					});
			});

			//add a handler for clicking/popups. 'click' is event listening for, 'equakes' is layer affected, function is the action it should do on the click
			//Thanks to: https://www.mapbox.com/mapbox-gl-js/example/popup-on-click/
			map.on('click', 'equakes', function (quake) {
						//1. set the coordinates of the popup (doesn't display the coordinates in the popup), case-sensitive
						var coordinates = quake.features[0].geometry.coordinates;
						//2. create the information that will display in the popup
						//var description = e.features[0].properties.mag;
						var description = "<h3>"+quake.features[0].properties.title+"</h3>"+"<p>Magnitude: " + quake.features[0].properties.mag + "<br>Location: " + quake.features[0].properties.place + "<br>" +
				 		'<a href="'+ quake.features[0].properties.url + '">More Information</a> + "</p>";
						//3. make the popup
						new mapboxgl.Popup()
										.setLngLat(coordinates)
										.setHTML(description)
										.addTo(map);
			});

		</script>
	</body>
</html>
